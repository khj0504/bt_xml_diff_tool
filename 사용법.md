# 🌳 BT XML Diff Tool 상세 사용법

gaemi_task 레포지토리의 Git 브랜치간 BehaviorTree XML 파일 변경사항을 분석하고 시각화하는 도구입니다.

## 📋 개요

이 도구는 두 Git 브랜치 사이의 BehaviorTree XML 파일들을 비교하여:
- 📊 구조적 변경사항 분석
- 🎨 인터랙티브 트리 시각화
- 🔍 노드별 차이점 하이라이팅
- 📈 변경사항 요약 리포트

## 🛠️ 설치 및 설정

### 1. 의존성 확인
```bash
cd /home/khj/colcon_ws/src/bt_xml_diff_tool
./setup.sh
```

필요한 도구들:
- Python 3.6+
- Git
- 웹 브라우저
- curl (서버 상태 확인용)

### 2. 권한 설정
```bash
chmod +x run_analysis.sh
chmod +x start_server.sh  
chmod +x setup.sh
```

## 🚀 기본 사용법

### 방법 1: 원클릭 실행 (추천)

```bash
# gaemi_task 레포지토리에서 직접 실행
cd /path/to/gaemi_task
/home/khj/colcon_ws/src/bt_xml_diff_tool/run_analysis.sh <소스브랜치> <타겟브랜치>

# 예시
cd /home/khj/colcon_ws/src/gaemi_task  
/home/khj/colcon_ws/src/bt_xml_diff_tool/run_analysis.sh main hotfix-speedgate-delay
```

### 방법 2: bt_xml_diff_tool에서 실행

```bash
cd /home/khj/colcon_ws/src/bt_xml_diff_tool
./run_analysis.sh main hotfix-speedgate-delay --repo-path /home/khj/colcon_ws/src/gaemi_task
```

### 방법 3: Python 직접 실행

```bash
cd /home/khj/colcon_ws/src/bt_xml_diff_tool
python3 enhanced_branch_analyzer.py main hotfix-speedgate-delay --repo-path /home/khj/colcon_ws/src/gaemi_task
```

## 📚 명령어 옵션

### run_analysis.sh 옵션

```bash
./run_analysis.sh <소스브랜치> <타겟브랜치> [옵션]

인수:
  <소스브랜치>    비교 기준 브랜치 (예: main, develop)
  <타겟브랜치>    비교 대상 브랜치 (예: feature-branch, hotfix-*)

옵션:
  -p, --port      HTTP 서버 포트 (기본값: 8080)
  -r, --repo-path Git 레포지토리 경로 (기본값: 현재 디렉토리)
  -h, --help      도움말 출력
```

### Python 스크립트 옵션

```bash
python3 enhanced_branch_analyzer.py <소스브랜치> <타겟브랜치> [옵션]

옵션:
  --output, -o        출력 HTML 파일명 (기본값: bt_diff_result.html)
  --repo-path, -r     Git 레포지토리 경로 (기본값: 현재 디렉토리)
  --help, -h          도움말 출력
```

## 💻 실사용 예시

### 예시 1: 메인 브랜치와 피처 브랜치 비교
```bash
cd /home/khj/colcon_ws/src/gaemi_task
/home/khj/colcon_ws/src/bt_xml_diff_tool/run_analysis.sh main feature-new-behavior
```

### 예시 2: 개발 브랜치와 핫픽스 비교  
```bash
cd /home/khj/colcon_ws/src/bt_xml_diff_tool
./run_analysis.sh develop hotfix-speedgate-delay --repo-path ../gaemi_task
```

### 예시 3: 커스텀 포트로 실행
```bash
./run_analysis.sh main feature-branch --port 8090 --repo-path ../gaemi_task
```

### 예시 4: 특정 출력 파일명 지정
```bash
python3 enhanced_branch_analyzer.py main feature-branch \
  --repo-path ../gaemi_task \
  --output my_analysis_result.html
```

## 📊 결과 확인

### 자동 브라우저 실행
`run_analysis.sh` 사용 시 분석 완료 후 자동으로 브라우저가 열립니다.

### 수동 확인
```bash
# HTML 파일을 브라우저에서 열기
firefox bt_diff_result.html
# 또는
xdg-open bt_diff_result.html
```

### 웹 서버로 확인
```bash
# HTTP 서버 시작 (포트 8080)
./start_server.sh 8080

# 브라우저에서 http://localhost:8080/bt_diff_result.html 접속
```

## 🎨 시각화 해석

### 색상 의미
- 🟢 **녹색**: 새로 추가된 노드
- 🔴 **빨간색**: 삭제된 노드  
- 🟡 **노란색**: 수정된 노드
- ⚪ **흰색**: 변경되지 않은 노드

### 변경 유형
- **Added Nodes**: 새로 추가된 액션/조건/제어 노드
- **Removed Nodes**: 삭제된 노드들
- **Modified Nodes**: 속성이 변경된 노드들
- **SubTree Changes**: 서브트리 구조 변경

### 인터랙티브 기능
- **줌/팬**: 마우스 휠과 드래그로 트리 탐색
- **노드 클릭**: 노드 정보 표시
- **트리 접기/펼치기**: 복잡한 트리 구조 탐색

## 🔧 문제 해결

### 일반적인 오류들

#### 1. Git 브랜치 오류
```bash
# 오류: unknown revision or path not in the working tree
# 해결: 브랜치 존재 여부 확인
git branch -a
git fetch origin  # 원격 브랜치 가져오기
```

#### 2. 포트 충돌 오류
```bash
# 오류: Address already in use
# 해결: 다른 포트 사용
./run_analysis.sh main feature-branch --port 8090
```

#### 3. 권한 오류
```bash
# 오류: Permission denied
# 해결: 실행 권한 부여
chmod +x run_analysis.sh start_server.sh setup.sh
```

#### 4. Python 모듈 오류
```bash
# 오류: ModuleNotFoundError
# 해결: 의존성 재확인
./setup.sh
pip3 install --user lxml beautifulsoup4
```

### 디버깅 모드

상세한 로그 확인:
```bash
# 디버그 정보와 함께 실행
python3 enhanced_branch_analyzer.py main feature-branch \
  --repo-path ../gaemi_task 2>&1 | tee debug.log
```

## 📁 출력 파일

### 기본 출력
- `bt_diff_result.html`: 메인 결과 파일 (인터랙티브 시각화)

### 파일 구조
```
bt_diff_result.html
├── 변경사항 요약 섹션
├── Before 트리 (소스 브랜치)
├── After 트리 (타겟 브랜치)
└── 인터랙티브 D3.js 시각화
```

## 🚨 주의사항

### 필수 조건
1. **Git 레포지토리**: 분석할 디렉토리가 Git 레포지토리여야 함
2. **브랜치 존재**: 지정한 두 브랜치가 모두 존재해야 함
3. **XML 형식**: BehaviorTree.CPP 호환 XML 형식만 지원
4. **네트워크**: HTTP 서버 포트가 사용 가능해야 함

### 성능 고려사항
- 큰 XML 파일의 경우 분석 시간이 오래 걸릴 수 있음
- 복잡한 트리는 브라우저에서 렌더링 시간 소요
- 메모리 사용량은 트리 크기에 비례

### 지원 형식
- ✅ BehaviorTree.CPP XML 형식
- ✅ 표준 BT 노드 타입 (Action, Condition, Control)
- ✅ SubTree 참조
- ✅ 노드 속성 및 파라미터

## 🎯 활용 사례

### 코드 리뷰
```bash
# PR 리뷰 시 변경사항 시각화
./run_analysis.sh main feature/pr-123 --repo-path ../gaemi_task
```

### 버전 비교
```bash
# 릴리스 간 차이점 분석
./run_analysis.sh v1.0.0 v1.1.0 --repo-path ../gaemi_task
```

### 핫픽스 검증
```bash
# 핫픽스가 올바르게 적용되었는지 확인
./run_analysis.sh main hotfix-urgent-fix --repo-path ../gaemi_task
```

---

## 💡 팁과 베스트 프랙티스

1. **브랜치명 확인**: `git branch -a`로 정확한 브랜치명 확인
2. **최신 상태 유지**: `git fetch origin`으로 최신 브랜치 정보 동기화
3. **결과 저장**: 중요한 분석 결과는 다른 이름으로 저장
4. **성능 최적화**: 큰 프로젝트는 특정 경로만 분석 고려
5. **브라우저 호환성**: 최신 브라우저 사용 권장 (Chrome, Firefox, Edge)

이 도구를 사용하여 BehaviorTree의 변경사항을 쉽게 파악하고 코드 품질을 향상시키세요! 🚀